CREATE TABLE TBL_MS_ADVERTISER WITH (KEY='ADVERTISER_ID', VALUE_FORMAT='AVRO', KAFKA_TOPIC='NBC_APPS.TBL_MS_ADVERTISER');

CREATE STREAM TBL_MS_PLAN_WK  WITH (VALUE_FORMAT='AVRO', KAFKA_TOPIC='NBC_APPS.TBL_MS_PLAN_WK1');

CREATE STREAM TBL_MS_ADVERTISER_RAW WITH (KAFKA_TOPIC='NBC_APPS.TBL_MS_ADVERTISER',VALUE_FORMAT='AVRO');

CREATE STREAM TBL_MS_ADVERTISER_RAW_REKEY AS SELECT * FROM TBL_MS_ADVERTISER_RAW PARTITION BY ADVERTISER_ID;

CREATE TABLE TBL_MS_ADVERTISER_rekeyed WITH (KEY='ADVERTISER_ID', VALUE_FORMAT='AVRO', KAFKA_TOPIC='TBL_MS_ADVERTISER_RAW_REKEY');

SELECT A.ADVERTISER_ID, B.ADVERTISER_ID ,A.PLAN_ID, A.PLAN_NAME,B.ADVERTISER_NAME,ADVERTISER_CREATION_DT FROM TBL_MS_PLAN_WK A LEFT JOIN TBL_MS_ADVERTISER_rekeyed B ON (A.ADVERTISER_ID = B.ADVERTISER_ID)
