Create a stream on Advertise 

NBC_APPS.TBL_MS_ADVERTISER_COMPACT1
NBC_APPS.TBL_MS_PROPERTY_COMPACT1
NBC_APPS.TBL_MS_ADVERTISER

CREATE STREAM TBL_MS_PLAN_WK  WITH (VALUE_FORMAT='AVRO', KAFKA_TOPIC='NBC_APPS.TBL_MS_PLAN_WK');


CREATE STREAM TBL_MS_ADVERTISER_RAW_STREAM WITH (KAFKA_TOPIC='NBC_APPS.TBL_MS_ADVERTISER_COMPACT1', VALUE_FORMAT='AVRO');

CREATE STREAM TBL_MS_ADVERTISER_RAW_AVRO_STREAM_REKEY WITH (PARTITIONS=1) AS SELECT * FROM TBL_MS_ADVERTISER_RAW_STREAM PARTITION BY advertiser_id;

CREATE TABLE TBL_MS_ADVERTISER WITH (KAFKA_TOPIC='TBL_MS_ADVERTISER_RAW_AVRO_STREAM_REKEY', VALUE_FORMAT='AVRO', KEY='advertiser_id');

SELECT A.ADVERTISER_ID,B.ADVERTISER_ID FROM TBL_MS_PLAN_WK A LEFT JOIN TBL_MS_ADVERTISER B ON (A.ADVERTISER_ID =B.ADVERTISER_ID)

CREATE STREAM TBL_PLAN_ADVERTISER1 WITH (PARTITIONS=1) AS SELECT A.PLAN_ID,A.op_type,A.ADVERTISER_ID,A.PLAN_NAME,A.ORIGINAL_PLAN_ID,A.PORTFOLIO_PLAN_ID,A.STEW_LINK_ID,A.PRG_PLAN_ID,A.REVISION_NO,A.PROPERTY_ID,B.ADVERTISER_NAME FROM TBL_MS_PLAN_WK A LEFT JOIN TBL_MS_ADVERTISER B ON (A.ADVERTISER_ID =B.ADVERTISER_ID)



CREATE STREAM TBL_MS_PROPERTY_RAW_STREAM WITH (KAFKA_TOPIC='NBC_APPS.TBL_MS_PROPERTY_COMPACT1', VALUE_FORMAT='AVRO');

CREATE STREAM TBL_MS_PROPERTY_RAW_STREAM_REKEY WITH (PARTITIONS=1) AS SELECT * FROM TBL_MS_PROPERTY_RAW_STREAM PARTITION BY PROPERTY_ID;

CREATE TABLE TBL_MS_PROPERTY WITH (KAFKA_TOPIC='TBL_MS_PROPERTY_RAW_STREAM_REKEY', VALUE_FORMAT='AVRO', KEY='PROPERTY_ID');


"10247":{"table1": "NBC_APPS.TBL_MS_PROPERTY", "op_type": "U", "op_ts": "2018-07-18 18:51:34.000000", "current_ts": "2018-07-18 14:51:39.397000", "pos": "00000003470236836100","PROPERTY_ID": 10247, "PROPERTY_NAME": "Bravo", "NETWORK_ID": "1806","PARENT_CHANNEL_ID": "-1","AUTOMATION_CODE": "3202000" ,"AUTOMATION_NAME": "NULL","CALL_SIGN_NAME": "Bravo","SALES_DAYPART_SET_ID": "1991","CREATE_DATE": "30-AUG-18","RATED_NETWORK": "3111001"}

CREATE STREAM TBL_PLAN_ADVERTISER_PROPERTY WITH (PARTITIONS=1) AS select A.A_OP_TYPE, A.A_ADVERTISER_ID,A.PLAN_NAME,A.ORIGINAL_PLAN_ID,A.PORTFOLIO_PLAN_ID,A.STEW_LINK_ID,A.PRG_PLAN_ID,A.REVISION_NO,A.PROPERTY_ID,A.ADVERTISER_NAME,B.PROPERTY_NAME FROM TBL_PLAN_ADVERTISER1 A left join TBL_MS_PROPERTY B ON (A.PROPERTY_ID = B.PROPERTY_ID);



 A_OP_TYPE         | VARCHAR(STRING)           
 A_ADVERTISER_ID   | BIGINT                    
 PLAN_NAME         | VARCHAR(STRING)           
 ORIGINAL_PLAN_ID  | BIGINT                    
 PORTFOLIO_PLAN_ID | BIGINT                    
 STEW_LINK_ID      | BIGINT                    
 PRG_PLAN_ID       | VARCHAR(STRING)           
 REVISION_NO       | BIGINT                    
 PROPERTY_ID       | BIGINT                    
 ADVERTISER_NAME   | VARCHAR(STRING)    
 
 

select topic in KSQL :


CREATE TABLE TBL_PLAN_ADVTSER_PROPERTY ( 
"PLAN_ID" BIGINT, 
"op_type" TEXT,
"ADVERTISER_ID" BIGINT, 
"PLAN_NAME" TEXT, 
"ORIGINAL_PLAN_ID" TEXT,  
"PORTFOLIO_PLAN_ID" BIGINT, 
"STEW_LINK_ID" BIGINT,
"PRG_PLAN_ID" BIGINT,
"REVISION_NO" BIGINT,
"PROPERTY_ID" BIGINT,
"ADVERTISER_NAME" TEXT,
"PROPERTY_NAME" TEXT,
PRIMARY KEY ("PLAN_ID"));


create stream PLANADVERTISE WITH (PARTITIONS=1) as select plan_id,a.advertiser_id,advertiser_name,original_plan_id,plan_name,portfolio_plan_id,prg_plan_id,property_id,revision_no,stew_link_id from TBL_MS_PLAN_WK a join TBL_MS_ADVERTISER b on (a.advertiser_id = b.advertiser_id);
